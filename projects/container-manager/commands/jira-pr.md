# /jira-pr - JIRA-Integrated Pull Request

Create GitHub pull requests with JIRA ticket linking for container-manager.

## Usage
```bash
/jira-pr <ticket-id> [--target-branch <branch>]
```

## Arguments
- `<ticket-id>`: CCU2-XXXXX format JIRA ticket ID
- `--target-branch`: Target branch for PR (default: master)

## Examples
```bash
# PR to default branch (master)
/jira-pr CCU2-12345

# PR to specific branch
/jira-pr CCU2-12345 --target-branch dev
```

## PR Description Template
```markdown
## JIRA Ticket
**Ticket**: [CCU2-12345](https://jira.company.com/browse/CCU2-12345)
**Summary**: <Ticket summary from JIRA>
**Priority**: <Priority level>
**Status**: <Current status>

## Changes
<Auto-generated from commit messages in this branch>

## Testing
- [ ] Build passes for LGE tier
- [ ] Build passes for MOBIS tier
- [ ] MISRA compliance checked
- [ ] Unit tests passing (if applicable)

## Build Information
- **Project**: container-manager
- **Build System**: Yocto + CMake
- **Tiers**: LGE, MOBIS
- **ECUs**: CCU2, CCU2_LITE, BCU

## Checklist
- [ ] Code follows MISRA C++ 2023 standards
- [ ] No new fatal MISRA violations
- [ ] Documentation updated (if needed)
- [ ] JIRA ticket updated with PR link
```

## Implementation Steps

1. **Validate Ticket Format**
   - Check CCU2-XXXXX pattern
   - Error if invalid format

2. **Fetch Ticket Details**
   - Get summary, priority, status from JIRA
   - Generate ticket link

3. **Analyze Commit History**
   - Get all commits in current branch
   - Extract commit messages and file changes
   - Identify affected components

4. **Check Git State**
   - Verify current branch is not master
   - Check if remote branch exists
   - Verify commits are pushed

5. **Generate PR Description**
   - Use template with JIRA information
   - Include commit summaries
   - Add testing checklist

6. **Create Pull Request**
   ```bash
   gh pr create \
     --title "[CCU2-12345] <Ticket summary>" \
     --body "<Generated description>" \
     --base master
   ```

7. **Update JIRA** (Optional)
   - Add PR link to JIRA ticket comments
   - Update ticket status if configured

## Prerequisites
- `~/.env` must contain:
  - `JIRA_URL`: JIRA instance URL
  - `JIRA_TOKEN`: API token
- GitHub CLI (`gh`) installed and authenticated
- Current branch pushed to remote
- Commits exist on current branch

## Error Handling
- Invalid ticket format → Error with example
- Not on feature branch → Error: "Cannot create PR from master"
- No commits → Error: "No commits to create PR"
- JIRA API failure → Continue with manual description
- GitHub API failure → Show error and suggest manual PR
